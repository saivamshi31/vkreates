<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | V'Kreates</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Montserrat:wght@500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .admin-container {
            max-width: 1000px;
            margin: 100px auto;
            padding: 2rem;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .admin-section {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: var(--card-radius);
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .item-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.03);
            padding: 1rem;
            border-radius: 8px;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .item-actions button {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: 0.3s;
        }

        .item-actions button:hover {
            color: var(--accent-color);
        }

        .item-actions button.delete:hover {
            color: #ff4757;
        }

        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .login-box {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: var(--card-radius);
            text-align: center;
            width: 300px;
        }

        #json-output {
            display: none;
        }
    </style>
</head>

<body>

    <!-- Login Screen -->
    <div class="login-overlay" id="login-screen">
        <div class="login-box">
            <h2 style="margin-bottom: 1rem;">Admin Login</h2>
            <div class="form-group">
                <input type="password" id="password" placeholder="Enter Password">
            </div>
            <button class="btn btn-primary btn-block" onclick="checkLogin()">Login</button>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="admin-container" id="dashboard" style="display: none;">
        <div class="admin-header">
            <div>
                <h1>Dashboard</h1>
                <p style="color: var(--text-secondary);">Manage your products and services</p>
            </div>
            <div style="display: flex; gap: 1rem;">
                <a href="index.html" class="btn btn-secondary" target="_blank">View Site</a>
                <button class="btn btn-primary" onclick="exportData()"><i class="fas fa-save"></i> Save Changes</button>
            </div>
        </div>

        <!-- Products Section -->
        <div class="admin-section">
            <div class="section-header"
                style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                <h2>Products</h2>
                <button class="btn btn-sm btn-primary" onclick="openModal('product')"><i class="fas fa-plus"></i> Add
                    Product</button>
            </div>
            <div class="item-list" id="products-list">
                <!-- Products rendering here -->
            </div>
        </div>
    </div>

    <!-- Edit Modal (Simplified) -->
    <div class="login-overlay" id="edit-modal" style="display: none; background: rgba(0,0,0,0.8);">
        <div class="login-box" style="width: 500px; text-align: left;">
            <h2 id="modal-title" style="margin-bottom: 1rem;">Add Item</h2>
            <form id="edit-form">
                <input type="hidden" id="edit-id">
                <input type="hidden" id="edit-type">

                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="edit-title" required>
                </div>
                <div class="form-group">
                    <label>Price / Price Label</label>
                    <input type="text" id="edit-price">
                </div>
                <div class="form-group">
                    <label>Image Path</label>
                    <input type="text" id="edit-image" value="placeholder">
                    <small style="color: var(--text-secondary); display: block; margin-top: 5px;">
                        <i class="fas fa-info-circle"></i> Place your image file in the <b>images</b> folder.<br>
                        Then type: <code>images/your-filename.jpg</code>
                    </small>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button type="button" class="btn btn-secondary btn-block" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary btn-block" style="margin-top: 0;">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script>
        // Simple client-side auth
        const checkLogin = () => {
            const pass = document.getElementById('password').value;
            if (pass === 'admin123') { // Change this if needed
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                renderAdminLists();
            } else {
                alert('Incorrect password');
            }
        };

        // Render Lists
        const renderAdminLists = () => {
            const pList = document.getElementById('products-list');
            pList.innerHTML = window.siteData.products.map(p => `
                <div class="list-item">
                    <span>${p.title} (${p.price})</span>
                    <div class="item-actions">
                        <button onclick="editItem('product', ${p.id})"><i class="fas fa-edit"></i></button>
                        <button class="delete" onclick="deleteItem('product', ${p.id})"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `).join('');
        };

        // Modal Logic
        const openModal = (type) => {
            document.getElementById('edit-modal').style.display = 'flex';
            document.getElementById('edit-type').value = type;
            document.getElementById('modal-title').innerText = 'Add ' + type.charAt(0).toUpperCase() + type.slice(1);
            document.getElementById('edit-form').reset();
            document.getElementById('edit-id').value = '';
            document.getElementById('edit-image').value = 'placeholder';
        };

        const closeModal = () => {
            document.getElementById('edit-modal').style.display = 'none';
        };

        const editItem = (type, id) => {
            const item = window.siteData[type + 's'].find(i => i.id === id);
            openModal(type);
            document.getElementById('modal-title').innerText = 'Edit ' + type.charAt(0).toUpperCase() + type.slice(1);
            document.getElementById('edit-id').value = item.id;
            document.getElementById('edit-title').value = item.title;
            document.getElementById('edit-price').value = item.price;
            document.getElementById('edit-image').value = item.image;
        };

        const deleteItem = (type, id) => {
            if (confirm('Are you sure?')) {
                window.siteData[type + 's'] = window.siteData[type + 's'].filter(i => i.id !== id);
                renderAdminLists();
            }
        };

        // Save Logic
        document.getElementById('edit-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const type = document.getElementById('edit-type').value;
            const id = document.getElementById('edit-id').value;

            const newItem = {
                id: id ? parseInt(id) : Date.now(),
                title: document.getElementById('edit-title').value,
                price: document.getElementById('edit-price').value,
                image: document.getElementById('edit-image').value,
                cartLink: "buy.html" // Default
            };

            const listKey = type + 's';
            if (id) {
                const index = window.siteData[listKey].findIndex(i => i.id == id);
                window.siteData[listKey][index] = { ...window.siteData[listKey][index], ...newItem };
            } else {
                window.siteData[listKey].push(newItem);
            }

            closeModal();
            renderAdminLists();
        });

        // Export Function
        const exportData = () => {
            const dataContent = `
const products = ${JSON.stringify(window.siteData.products, null, 4)};

const services = ${JSON.stringify(window.siteData.services, null, 4)};

// Verify if we are in the browser context to avoid errors in node environments during testing
if (typeof window !== 'undefined') {
    window.siteData = { products, services };
}
`;
            const blob = new Blob([dataContent], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'data.js';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('File downloaded! Please replace js/data.js with this new file.');
        };

    </script>
</body>

</html>